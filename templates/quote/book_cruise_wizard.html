{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Book {{ cruise.name }} - Travel in Style{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wizard.css' %}">
{% endblock %}

{% block content %}
<div class="wizard-container">
    <h1>Book Your Cruise: {{ cruise.name }}</h1>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ wizard.management_form }}
        
        <div class="form-content">
            {% if wizard.steps.current == 'passenger_count' %}
                <h3>Number of Passengers</h3>
                {% crispy wizard.form %}
                
            {% elif wizard.steps.current == 'passenger_info' %}
                <h3>Passenger Information</h3>
                
                <!-- Ensure management form is included for the formset -->
                {{ wizard.form.management_form }}
                
                {% for form in wizard.form.forms %}
                    <div class="passenger-form mb-4">
                        <h4>Passenger {{ forloop.counter }}</h4>
                        {% crispy form %}
                    </div>
                {% endfor %}
                
            {% elif wizard.steps.current == 'cruise_selection' %}
                <h3>Select Cruise Details</h3>
                {% crispy wizard.form %}
                
            {% elif wizard.steps.current == 'confirmation' %}
                <h3>Confirmation</h3>
                {% crispy wizard.form %}
                
            {% endif %}
        </div>

        <div class="form-navigation">
            {% if wizard.steps.prev %}
                <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}" class="btn btn-secondary btn-wizard">Previous</button>
            {% else %}
                <div></div>
            {% endif %}
            <button type="submit" class="btn btn-primary btn-wizard">
                {% if wizard.steps.next %}Next{% else %}Complete Booking{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}
